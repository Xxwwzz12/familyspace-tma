import axios from 'axios';

const baseURL = import.meta.env.VITE_API_BASE_URL || 'http://localhost:3000/api';

export const apiClient = axios.create({
  baseURL: baseURL,
  withCredentials: false, // ðŸŸ¡ Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ð² true, ÐµÑÐ»Ð¸ Ð±ÑÐºÐµÐ½Ð´ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ ÐºÑƒÐºÐ¸ Ð¸Ð»Ð¸ Ð°ÑƒÑ‚ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ðµ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ¸
  timeout: 15000,
  headers: {
    'Content-Type': 'application/json',
  },
});

// Ð˜Ð½Ñ‚ÐµÑ€Ñ†ÐµÐ¿Ñ‚Ð¾Ñ€ Ð´Ð»Ñ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ñ‚Ð¾ÐºÐµÐ½Ð°
apiClient.interceptors.request.use((config) => {
  const token = localStorage.getItem('token');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// Ð˜Ð½Ñ‚ÐµÑ€Ñ†ÐµÐ¿Ñ‚Ð¾Ñ€ Ð´Ð»Ñ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾, Ð´Ð»Ñ Ð¾Ñ‚Ð»Ð°Ð´ÐºÐ¸)
apiClient.interceptors.request.use((request) => {
  console.log(`ðŸ›œ ÐžÑ‚Ð¿Ñ€Ð°Ð²ÐºÐ° Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°: ${request.method?.toUpperCase()} ${request.baseURL}${request.url}`);
  return request;
});

// Ð˜Ð½Ñ‚ÐµÑ€Ñ†ÐµÐ¿Ñ‚Ð¾Ñ€ Ð´Ð»Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¾ÑˆÐ¸Ð±Ð¾Ðº
apiClient.interceptors.response.use(
  (response) => {
    return response;
  },
  (error) => {
    if (error.response && error.response.status === 401) {
      // ÐŸÐµÑ€ÐµÐ½Ð°Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð½Ð° Ð¾Ð½Ð±Ð¾Ñ€Ð´Ð¸Ð½Ð³ Ð¿Ñ€Ð¸ 401 Ð¾ÑˆÐ¸Ð±ÐºÐµ
      localStorage.removeItem('token');
      window.location.href = '/onboarding';
    }
    return Promise.reject(error);
  }
);